<!DOCTYPE html>
<html>
<body>

<p>This FMU was generated by <b>Dymola 2022</b></p>

<p><b>Dymola 2022</b> is &copy; 1998-2021 Dassault Syst&egrave;mes</p>
<br>

<h2>Open-source components</h2>

<p>The FMU may include open-source software components. Source code for these components is available on request. </p>
<p>The original licensors of said open-source software components provide them on an &#8220;as is&#8221; basis and 
without any liability whatsoever to customer (or licensee).</p>

<p>See <a href="_opensource.html">this page</a> for a list of open-source components used
by FMUs exported from <b>Dymola 2022</b>.</p>
<br>

<h2>Source code distribution</h2>

<p>If the FMU is exported to include sources, the source code is provided in the directory "sources". Except for a file containing the C main function, the files listed below needs to be compiled as separate compilation units. The remaining C files distributed are included from those in one way or another. Some header files from SUNDIALS are located in sub directories, e.g. "cvode" to match the original SUNDIALS code structure. This is necessary since some #include statements rely on this structure.

<p>
The files below are sufficent to create a DLL or shared object file. For a complete executable, also a main program is needed of course.
</p>

<p>
cvode.c <br/>
cvode_dense.c <br/>
cvode_direct.c <br/>
cvode_io.c <br/>
dsmodel.c <br/>
fmiCommonFunctions_int.c <br/>
fmiCoSimFunctions_int.c <br/>
fmiFunctions.c <br/>
fmiMEFunctions_int.c <br/>
integration.c <br/>
jac.c <br/>
mmap.c <br/>
nvector_serial.c <br/>
sundials_dense.c <br/>
sundials_direct.c <br/>
sundials_math.c <br/>
sundials_nvector.c <br/>
tpl.c <br />
util.c
</p>

<p>
If you set the MODEL_IDENTIFIER (FMI 1) or FMI2_FUNCTION_PREFIX (FMI 2) explicitly in your source code, e.g.:

<pre>
#define FMI2_FUNCTION_PREFIX MyModel_
#include "fmiFunctions.h"
</pre>

you must also update fmiModelIdentifier.h accordingly.
</p>

<p>
If your target platform does not have a file system you have to define NO_FILE in conf.h:
<pre>
#define NO_FILE
</pre>
</p>


<h3>Handling multiple FMUs</h3>
<p>In order to be able to combine several source code FMUs, the internal functions and symbols need to be static. This in turn requires that
the whole source code is compiled in a single compilation unit. To facilitate this, an extra source code file</p>
<pre>all.c</pre>
<p>is provided, that includes all other C files. The only disadvantage of compiling this instead, is that any modification in the source code
requires re-compilation of everything.</p>
<br>


<h2>Enabling sparse solver</h2>
<p>
Additional source files are needed to enable sparse solution of linear systems during simulation. The required CVode and SUNDIALS files are located in the "source" subdirectory of the Dymola installation directory. If the flag
<pre>Advanced.SparseActivate = true</pre>
is enabled during FMU source code export these files are copied to the "sources" subdirectory of the FMU. To enable the code for the sparse solver define the preprocessor macro
<pre>#define FMU_SOURCE_CODE_EXPORT_SPARSE</pre>
Furthermore, the following three files must be compiled in addition to those listed above
</p>
<p>
cvode_sparse.c<br/>
cvode_superlumt.c<br/>
sundials_sparse.c<br/>
</p>
<p>
For all.c these are incorporated automatically when setting FMU_SOURCE_CODE_EXPORT_SPARSE.<br>
These files implement the interface between CVode and the default sparse linear algebra library: SuperLU_MT Version 2.4. You must link with this library when building the excecutable. The source code can be found at <a href="https://portal.nersc.gov/project/sparse/superlu/#superlu_mt/">portal.nersc.gov/project/sparse/superlu/#superlu_mt/</a>.
</p>
<p>
(Note: You must also define <code>DYNSparseJacobian_</code> if it is not already defined in dsmodel.c. Its value affects the number of cores that are used during sparse matrix factorization.) 
</p>

<br>
<br>

</body>
</html>
